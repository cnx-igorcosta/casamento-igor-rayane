var app=angular.module("autocomplete",[]);
app.directive("autocomplete",function(){var b=-1;return{restrict:"E",scope:{searchParam:"=ngModel",suggestions:"=data",onType:"=onType",onSelect:"=onSelect",autocompleteRequired:"="},controller:["$scope",function(a){a.selectedIndex=-1;a.initLock=!0;a.setIndex=function(b){a.selectedIndex=parseInt(b)};this.setIndex=function(b){a.setIndex(b);a.$apply()};a.getIndex=function(b){return a.selectedIndex};var b=!0;a.completing=!1;a.$watch("searchParam",function(c,d){if(d!==c&&(d||!a.initLock)&&(b&&"undefined"!==
typeof a.searchParam&&null!==a.searchParam&&(a.completing=!0,a.searchFilter=a.searchParam,a.selectedIndex=-1),a.onType))a.onType(a.searchParam)});this.preSelect=function(c){b=!1;a.$apply();b=!0};a.preSelect=this.preSelect;this.preSelectOff=function(){b=!0};a.preSelectOff=this.preSelectOff;a.select=function(c){if(c&&(a.searchParam=c,a.searchFilter=c,a.onSelect))a.onSelect(c);b=!1;a.completing=!1;setTimeout(function(){b=!0},1E3);a.setIndex(-1)}}],link:function(a,d,c){setTimeout(function(){a.initLock=
!1;a.$apply()},250);var f="";a.attrs={placeholder:"Nome","class":"",id:"",inputclass:"",inputid:""};for(var g in c)f=g.replace("attr","").toLowerCase(),0===g.indexOf("attr")&&(a.attrs[f]=c[g]);c.clickActivation&&(d[0].onclick=function(b){a.searchParam||setTimeout(function(){a.completing=!0;a.$apply()},200)});document.addEventListener("keydown",function(b){switch(b.keyCode||b.which){case 27:a.select(),a.setIndex(-1),a.$apply(),b.preventDefault()}},!0);document.addEventListener("blur",function(b){setTimeout(function(){a.select();
a.setIndex(-1);a.$apply()},150)},!0);d[0].addEventListener("keydown",function(c){var d=c.keyCode||c.which,e=angular.element(this).find("li").length;if(a.completing&&0!=e)switch(d){case 38:b=a.getIndex()-1;if(-1>b)b=e-1;else if(b>=e){b=-1;a.setIndex(b);a.preSelectOff();break}a.setIndex(b);-1!==b&&a.preSelect(angular.element(angular.element(this).find("li")[b]).text());a.$apply();break;case 40:b=a.getIndex()+1;if(-1>b)b=e-1;else if(b>=e){b=-1;a.setIndex(b);a.preSelectOff();a.$apply();break}a.setIndex(b);
-1!==b&&a.preSelect(angular.element(angular.element(this).find("li")[b]).text());break;case 39:case 13:case 9:b=a.getIndex();-1!==b?(a.select(angular.element(angular.element(this).find("li")[b]).text()),13==d&&c.preventDefault()):13==d&&a.select();a.setIndex(-1);a.$apply();break;case 27:a.select(),a.setIndex(-1),a.$apply(),c.preventDefault()}})},template:'        <div class="autocomplete {{ attrs.class }}" id="{{ attrs.id }}">          <input            type="text"            ng-model="searchParam"            placeholder="{{ attrs.placeholder }}"            class="{{ attrs.inputclass }}"            id="{{ attrs.inputid }}"            ng-required="{{ autocompleteRequired }}" />          <ul ng-show="completing && (suggestions | filter:searchFilter).length > 0">            <li              suggestion              ng-repeat="suggestion in suggestions | filter:searchFilter | orderBy:\'toString()\' track by $index"              index="{{ $index }}"              val="{{ suggestion }}"              ng-class="{ active: ($index === selectedIndex) }"              ng-click="select(suggestion)"              ng-bind-html="suggestion | highlight:searchParam"></li>          </ul>        </div>'}});
app.filter("highlight",["$sce",function(b){return function(a,d){if("function"===typeof a)return"";if(d){var c="("+d.split(/\ /).join(" |")+"|"+d.split(/\ /).join("|")+")",f=new RegExp(c,"gi");c.length&&(a=a.replace(f,'<span class="highlight">$1</span>'))}return b.trustAsHtml(a)}}]);app.directive("suggestion",function(){return{restrict:"A",require:"^autocomplete",link:function(b,a,d,c){a.bind("mouseenter",function(){c.preSelect(d.val);c.setIndex(d.index)});a.bind("mouseleave",function(){c.preSelectOff()})}}});
